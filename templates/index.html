{% extends "base.html" %} {% block content %}

<header class="page-header">
  <h1>BGCM - Campañas</h1>
  <p>Vista r&aacute;pida para mantener juegos y campañas al d&iacute;a.</p>
</header>

<div class="stack">
  <nav id="view-nav">
    <ul>
      <li>
        <a
          href="{{ url_for('index', view='games') }}"
          class="{{ 'contrast' if view == 'games' else 'secondary' }}"
          aria-current="{{ 'page' if view == 'games' else 'false' }}"
        >
          Juegos
        </a>
      </li>
      <li>
        <a
          href="{{ url_for('index', view='campaigns') }}"
          class="{{ 'contrast' if view == 'campaigns' else 'secondary' }}"
          aria-current="{{ 'page' if view == 'campaigns' else 'false' }}"
        >
          Campañas
        </a>
      </li>
    </ul>
    <small>Alterna entre las vistas para cada componente.</small>
  </nav>

  <div id="view-content" class="stack">
    {% if view == "games" %}
    <section class="stack">
      <h2 class="section-title">Juegos</h2>

      <article class="card">
        <form
          method="post"
          action="{{ url_for('index', view='games') }}"
          hx-push-url="true"
        >
          <p>
            <label for="game-name">Nombre del juego</label><br />
            <input type="text" id="game-name" name="game_name" required />
          </p>

          <p>
            <button type="submit">Guardar juego</button>
          </p>
        </form>
      </article>

      <article class="card">
        <h3>Listado</h3>
        <ul>
          {% for game in games %}
          <li>{{ game.name }}</li>
          {% else %}
          <li><em>- ninguno -</em></li>
          {% endfor %}
        </ul>
      </article>
    </section>
    {% else %}
    <section class="stack">
      <h2 class="section-title">Campañas</h2>

      <article class="card">
        <form
          method="post"
          action="{{ url_for('index', view='campaigns') }}"
          hx-push-url="true"
        >
          <p>
            <label for="campaign-name">Nombre de la campaña</label><br />
            <input
              type="text"
              id="campaign-name"
              name="campaign_name"
              required
            />
          </p>

          <p>
            <label for="game">Juego</label><br />
            <select id="game" name="game_id" required>
              <option value="">(seleccionar juego)</option>
              {% for game in games %}
              <option value="{{ game.id }}">{{ game.name }}</option>
              {% endfor %}
            </select>
          </p>

          <p>
            <label for="status">Estado</label><br />
            <select id="status" name="status">
              <option value="planificada">Planificada</option>
              <option value="pendiente">Pendiente</option>
              <option value="activa">Activa</option>
              <option value="finalizada">Finalizada</option>
            </select>
          </p>

          <p>
            <label>
              <input type="checkbox" name="abandoned" />
              Campaña abandonada
            </label>
          </p>

          <p>
            <button type="submit">Guardar campaña</button>
          </p>
        </form>
      </article>

      <article class="card">
        {% set status_sections = [ ("activa", "Activas"), ("pendiente",
        "Pendientes"), ("planificada", "Planificadas"), ("finalizada",
        "Finalizadas") ] %} {% for status_value, status_label in status_sections
        %}
        <h3>{{ status_label }}</h3>
        <ul>
          {% for campaign in campaigns if campaign.status.value == status_value
          %}
          <li>
            {% if campaign.abandoned %}
            <del>{{ campaign.name }} - {{ campaign.game.name }}</del>
            <small>(abandonada)</small>
            {% else %}
            <strong>{{ campaign.name }}</strong>
            <small>- {{ campaign.game.name }}</small>
            {% endif %}
          </li>
          {% else %}
          <li><em>- ninguna -</em></li>
          {% endfor %}
        </ul>
        {% if not loop.last %}
        <hr />
        {% endif %} {% endfor %}
      </article>
    </section>
    {% endif %}
  </div>
</div>

{% endblock %}
