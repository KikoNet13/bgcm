{% extends "base.html" %}

{% block page_header %}
<header class="app-header">
  <div class="header-left">
    <div class="brand">
      <div class="logo-placeholder" aria-hidden="true">Logo</div>
      <p class="brand-title">BGCM — BoardGame Campaign Manager</p>
    </div>
    <nav class="primary-tabs" aria-label="Navegación principal">
      <a
        href="{{ url_for('index', view='games') }}"
        class="{{ 'is-active' if view == 'games' else '' }}"
        aria-current="{{ 'page' if view == 'games' else 'false' }}"
      >
        Juegos
      </a>
      <a
        href="{{ url_for('index', view='campaigns') }}"
        class="{{ 'is-active' if view == 'campaigns' else '' }}"
        aria-current="{{ 'page' if view == 'campaigns' else 'false' }}"
      >
        Campañas
      </a>
    </nav>
  </div>
</header>
{% endblock %}

{% block content %}
<div id="view-content" class="stack">
  {% if view == "games" %}
  <section class="stack">
    <h2 class="section-title">Juegos</h2>

    <div class="view-layout">
      <article class="card">
        <h3>Listado</h3>
        <ul>
          {% for game in games %}
          <li>{{ game.name }}</li>
          {% else %}
          <li><em>- ninguno -</em></li>
          {% endfor %}
        </ul>
      </article>

      <article class="card card--muted">
        <h3>Crear datos</h3>
        <details>
          <summary class="toggle-summary">Añadir nuevo juego</summary>
          <form
            method="post"
            action="{{ url_for('index', view='games') }}"
            hx-push-url="true"
          >
            <p>
              <label for="game-name">Nombre del juego</label><br />
              <input type="text" id="game-name" name="game_name" required />
            </p>

            <p>
              <button type="submit">Guardar juego</button>
            </p>
          </form>
        </details>
      </article>
    </div>
  </section>
  {% else %}
  <section class="stack">
    <h2 class="section-title">Campañas</h2>

    <div class="view-layout">
      <article class="card">
        <h3>Estado actual</h3>
        {% set status_labels = {
        "planificada": "Planificada",
        "pendiente": "Pendiente",
        "activa": "Activa",
        "finalizada": "Finalizada"
        } %}
        <div class="campaigns-tabs">
          <input type="radio" name="campaign-tab" id="tab-all" checked />
          <input type="radio" name="campaign-tab" id="tab-active" />
          <input type="radio" name="campaign-tab" id="tab-pending" />
          <input type="radio" name="campaign-tab" id="tab-planned" />
          <input type="radio" name="campaign-tab" id="tab-finished" />
          <input type="radio" name="campaign-tab" id="tab-abandoned" />

          <div class="tab-controls">
            <label for="tab-all">Todas</label>
            <label for="tab-active">Activas</label>
            <label for="tab-pending">Pendientes</label>
            <label for="tab-planned">Planificadas</label>
            <label for="tab-finished">Finalizadas</label>
            <label for="tab-abandoned">Abandonadas</label>
          </div>

          <div class="campaigns-table">
            <table>
              <thead>
                <tr>
                  <th>Campaña</th>
                  <th>Juego</th>
                  <th>Estado</th>
                </tr>
              </thead>
              <tbody>
                {% for campaign in campaigns %}
                <tr
                  class="status-{{ campaign.status.value }} {% if campaign.abandoned %}is-abandoned{% endif %}"
                >
                  <td>
                    {% if campaign.abandoned %}
                    <del>{{ campaign.name }}</del>
                    {% else %}
                    {{ campaign.name }}
                    {% endif %}
                  </td>
                  <td>{{ campaign.game.name }}</td>
                  <td>
                    <span class="status-pill status-{{ campaign.status.value }}">
                      {{ status_labels[campaign.status.value] }}
                    </span>
                    {% if campaign.abandoned %}
                    <span class="status-pill status-abandoned">
                      Abandonada
                    </span>
                    {% endif %}
                  </td>
                </tr>
                {% else %}
                <tr>
                  <td colspan="3"><em>- ninguna -</em></td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </article>

      <article class="card card--muted">
        <h3>Crear datos</h3>
        <details>
          <summary class="toggle-summary">Añadir nueva campaña</summary>
          <form
            method="post"
            action="{{ url_for('index', view='campaigns') }}"
            hx-push-url="true"
          >
            <p>
              <label for="campaign-name">Nombre de la campaña</label><br />
              <input
                type="text"
                id="campaign-name"
                name="campaign_name"
                required
              />
            </p>

            <p>
              <label for="game">Juego</label><br />
              <select id="game" name="game_id" required>
                <option value="">(seleccionar juego)</option>
                {% for game in games %}
                <option value="{{ game.id }}">{{ game.name }}</option>
                {% endfor %}
              </select>
            </p>

            <p>
              <label for="status">Estado</label><br />
              <select id="status" name="status">
                <option value="planificada">Planificada</option>
                <option value="pendiente">Pendiente</option>
                <option value="activa">Activa</option>
                <option value="finalizada">Finalizada</option>
              </select>
            </p>

            <p>
              <label>
                <input type="checkbox" name="abandoned" />
                Campaña abandonada
              </label>
            </p>

            <p>
              <button type="submit">Guardar campaña</button>
            </p>
          </form>
        </details>
      </article>
    </div>
  </section>
  {% endif %}
</div>

{% endblock %}
