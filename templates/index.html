{% extends "base.html" %}

{% block page_header %}
<header>
  <nav aria-label="Acciones principales">
    <ul>
      <li><strong>Campañas</strong></li>
    </ul>
    <ul>
      <li>
        <a
          class="secondary"
          role="button"
          href="{{ url_for('index', form='campaign') }}"
        >
          Nueva campaña
        </a>
      </li>
      <li>
        <a
          class="secondary"
          role="button"
          href="{{ url_for('index', form='game') }}"
        >
          Nuevo juego
        </a>
      </li>
    </ul>
  </nav>
</header>
{% endblock %}

{% block content %}
<div id="view-content">
  <section>
    <article>
      <header>
        <h2>Campañas</h2>
      </header>
      <form
        method="get"
        action="{{ url_for('index') }}"
        hx-get="{{ url_for('index') }}"
        hx-trigger="change"
        hx-target="#campaigns-table"
        hx-select="#campaigns-table"
        hx-push-url="true"
      >
        <fieldset>
          <label for="filter-status">Estado</label>
          <select id="filter-status" name="status">
            <option value="">Todas</option>
            <option
              value="planificada"
              {% if filter_status == "planificada" %}selected{% endif %}
            >
              Planificada
            </option>
            <option
              value="pendiente"
              {% if filter_status == "pendiente" %}selected{% endif %}
            >
              Pendiente
            </option>
            <option
              value="activa"
              {% if filter_status == "activa" %}selected{% endif %}
            >
              Activa
            </option>
            <option
              value="finalizada"
              {% if filter_status == "finalizada" %}selected{% endif %}
            >
              Finalizada
            </option>
            <option
              value="abandonada"
              {% if filter_status == "abandonada" %}selected{% endif %}
            >
              Abandonada
            </option>
          </select>
        </fieldset>
        <fieldset>
          <label for="filter-game">Juego</label>
          <select id="filter-game" name="game_id">
            <option value="">Todos</option>
            {% for game in games %}
            <option
              value="{{ game.id }}"
              {% if filter_game_id == game.id|string %}selected{% endif %}
            >
              {{ game.name }}
            </option>
            {% endfor %}
          </select>
        </fieldset>
      </form>

      {% set status_labels = {
      "planificada": "Planificada",
      "pendiente": "Pendiente",
      "activa": "Activa",
      "finalizada": "Finalizada"
      } %}
      <div id="campaigns-table">
        <table>
          <thead>
            <tr>
              <th>Campaña</th>
              <th>Juego</th>
              <th>Estado</th>
            </tr>
          </thead>
          <tbody>
            {% for campaign in campaigns %}
            <tr>
              <td>
                {% if campaign.abandoned %}
                <del>{{ campaign.name }}</del>
                {% else %}
                {{ campaign.name }}
                {% endif %}
              </td>
              <td>{{ campaign.game.name }}</td>
              <td>
                {% if campaign.abandoned %}
                Abandonada
                {% else %}
                {{ status_labels[campaign.status.value] }}
                {% endif %}
              </td>
            </tr>
            {% else %}
            <tr>
              <td colspan="3"><em>- ninguna -</em></td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </article>
  </section>

  {% if form == "campaign" %}
  <article>
    <header>
      <h3>Nueva campaña</h3>
    </header>
    <form method="post" action="{{ url_for('index') }}" hx-push-url="true">
      <label for="campaign-name">Nombre</label>
      <input type="text" id="campaign-name" name="campaign_name" required />

      <label for="game">Juego</label>
      <select id="game" name="game_id" required>
        <option value="">(seleccionar juego)</option>
        {% for game in games %}
        <option value="{{ game.id }}">{{ game.name }}</option>
        {% endfor %}
      </select>

      <label for="status">Estado</label>
      <select id="status" name="status">
        <option value="planificada">Planificada</option>
        <option value="pendiente">Pendiente</option>
        <option value="activa">Activa</option>
        <option value="finalizada">Finalizada</option>
      </select>

      <footer>
        <button type="submit">Guardar campaña</button>
        <a class="secondary" role="button" href="{{ url_for('index') }}">
          Cancelar
        </a>
      </footer>
    </form>
  </article>
  {% endif %}

  {% if form == "game" %}
  <article>
    <header>
      <h3>Nuevo juego</h3>
    </header>
    <form method="post" action="{{ url_for('index') }}" hx-push-url="true">
      <label for="game-name">Nombre</label>
      <input type="text" id="game-name" name="game_name" required />

      <footer>
        <button type="submit">Guardar juego</button>
        <a class="secondary" role="button" href="{{ url_for('index') }}">
          Cancelar
        </a>
      </footer>
    </form>
  </article>
  {% endif %}
</div>

{% endblock %}
